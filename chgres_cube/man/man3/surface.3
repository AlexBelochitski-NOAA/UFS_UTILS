.TH "surface" 3 "Fri Mar 26 2021" "Version 1.0.0" "chgres_cube" \" -*- nroff -*-
.ad l
.nh
.SH NAME
surface \- Process surface and nst fields\&.  

.SH SYNOPSIS
.br
.PP
.SS "Functions/Subroutines"

.in +1c
.ti -1c
.RI "subroutine \fBadjust_soil_levels\fP (localpet)"
.br
.RI "Adjust soil levels of the input grid if there is a mismatch between input and target grids\&. "
.ti -1c
.RI "subroutine \fBadjust_soilt_for_terrain\fP"
.br
.RI "Adjust soil temperature for changes in terrain height between the input and target grids\&. "
.ti -1c
.RI "subroutine \fBcalc_liq_soil_moisture\fP"
.br
.RI "Compute liquid portion of the total soil moisture\&. "
.ti -1c
.RI "subroutine \fBcheck_smois_land\fP"
.br
.RI "Check soil mositure\&. "
.ti -1c
.RI "subroutine \fBcleanup_target_nst_data\fP"
.br
.RI "Free up memory once the target grid nst fields are no longer needed\&. "
.ti -1c
.RI "subroutine \fBcleanup_target_sfc_data\fP"
.br
.RI "Free up memory once the target grid surface fields are no longer needed\&. "
.ti -1c
.RI "subroutine \fBcreate_nst_esmf_fields\fP"
.br
.RI "Create ESMF fields for the target grid nst variables\&. "
.ti -1c
.RI "subroutine \fBcreate_surface_esmf_fields\fP"
.br
.RI "Create ESMF fields for the target grid surface variables\&. "
.ti -1c
.RI "real function \fBfrh2o\fP (TKELV, SMC, SH2O, SMCMAX, BEXP, PSIS)"
.br
.RI "Calculate supercooled soil moisture\&. "
.ti -1c
.RI "subroutine \fBij_to_i_j\fP (ij, itile, jtile, i, j)"
.br
.RI "Convert 1d index to 2d indices\&. "
.ti -1c
.RI "subroutine \fBinterp\fP (localpet)"
.br
.RI "Horizontally interpolate surface fields from input to target FV3 grid using esmf routines\&. "
.ti -1c
.RI "subroutine \fBnst_land_fill\fP"
.br
.RI "nst is not active at land or sea ice points\&. "
.ti -1c
.RI "subroutine \fBqc_check\fP"
.br
.RI "Perform some quality control checks before output\&. "
.ti -1c
.RI "subroutine \fBreplace_land_sfcparams\fP (localpet)"
.br
.RI "Replace bad surface points\&. "
.ti -1c
.RI "subroutine \fBrescale_soil_moisture\fP"
.br
.RI "Adjust soil moisture for changes in soil type between the input and target grids\&. "
.ti -1c
.RI "subroutine \fBroughness\fP"
.br
.RI "Set roughness length at land and sea ice\&. "
.ti -1c
.RI "subroutine, public \fBsurface_driver\fP (localpet)"
.br
.RI "Driver routine to process surface/nst data\&. "
.in -1c
.SS "Variables"

.in +1c
.ti -1c
.RI "real, parameter, private \fBblim\fP = 5\&.5"
.br
.RI "soil 'b' parameter limit "
.ti -1c
.RI "type(esmf_field), public \fBc_0_target_grid\fP"
.br
.RI "Coefficient 1 to calculate d(tz)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBc_d_target_grid\fP"
.br
.RI "Coefficient 2 to calculate d(tz)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBcanopy_mc_target_grid\fP"
.br
.RI "canopy moisture content "
.ti -1c
.RI "type(esmf_field), public \fBd_conv_target_grid\fP"
.br
.RI "Thickness of free convection layer\&. "
.ti -1c
.RI "type(esmf_field), public \fBdt_cool_target_grid\fP"
.br
.RI "Sub-layer cooling amount\&. "
.ti -1c
.RI "type(esmf_field), public \fBf10m_target_grid\fP"
.br
.RI "log((z0+10)*1/z0) See sfc_diff\&.f for details "
.ti -1c
.RI "type(esmf_field), public \fBffmm_target_grid\fP"
.br
.RI "log((z0+z1)*1/z0) See sfc_diff\&.f for details "
.ti -1c
.RI "real, parameter, private \fBfrz_h2o\fP = 273\&.15"
.br
.RI "melting pt water "
.ti -1c
.RI "real, parameter, private \fBfrz_ice\fP = 271\&.21"
.br
.RI "melting pt sea ice "
.ti -1c
.RI "real, parameter, private \fBgrav\fP = 9\&.81"
.br
.RI "gravity "
.ti -1c
.RI "real, parameter, private \fBhlice\fP = 3\&.335E5"
.br
.RI "latent heat of fusion "
.ti -1c
.RI "type(esmf_field), public \fBifd_target_grid\fP"
.br
.RI "Model mode index\&. "
.ti -1c
.RI "type(esmf_field), public \fBlai_target_grid\fP"
.br
.RI "leaf area index "
.ti -1c
.RI "type(esmf_field), public \fBq2m_target_grid\fP"
.br
.RI "2-m specific humidity "
.ti -1c
.RI "type(esmf_field), public \fBqrain_target_grid\fP"
.br
.RI "Sensible heat flux due to rainfall\&. "
.ti -1c
.RI "type(esmf_field), public \fBseaice_depth_target_grid\fP"
.br
.RI "sea ice depth "
.ti -1c
.RI "type(esmf_field), public \fBseaice_fract_target_grid\fP"
.br
.RI "sea ice fraction "
.ti -1c
.RI "type(esmf_field), public \fBseaice_skin_temp_target_grid\fP"
.br
.RI "sea ice skin temperature "
.ti -1c
.RI "type(esmf_field), public \fBskin_temp_target_grid\fP"
.br
.RI "skin temperature/sst "
.ti -1c
.RI "type(esmf_field), public \fBsnow_depth_target_grid\fP"
.br
.RI "physical snow depth "
.ti -1c
.RI "type(esmf_field), public \fBsnow_liq_equiv_target_grid\fP"
.br
.RI "liquid equiv snow depth "
.ti -1c
.RI "type(esmf_field), public \fBsoil_temp_target_grid\fP"
.br
.RI "3-d soil temperature "
.ti -1c
.RI "type(esmf_field) \fBsoil_type_from_input_grid\fP"
.br
.RI "soil type interpolated from input grid "
.ti -1c
.RI "type(esmf_field), public \fBsoilm_liq_target_grid\fP"
.br
.RI "3-d liquid soil moisture "
.ti -1c
.RI "type(esmf_field), public \fBsoilm_tot_target_grid\fP"
.br
.RI "3-d total soil moisture "
.ti -1c
.RI "type(esmf_field), public \fBsrflag_target_grid\fP"
.br
.RI "snow/rain flag "
.ti -1c
.RI "type(esmf_field), public \fBt2m_target_grid\fP"
.br
.RI "2-m temperatrure "
.ti -1c
.RI "type(esmf_field) \fBterrain_from_input_grid\fP"
.br
.RI "terrain height interpolated from input grid "
.ti -1c
.RI "type(esmf_field) \fBterrain_from_input_grid_land\fP"
.br
.RI "terrain height interpolated from input grid at all land points "
.ti -1c
.RI "type(esmf_field), public \fBtprcp_target_grid\fP"
.br
.RI "precip "
.ti -1c
.RI "type(esmf_field), public \fBtref_target_grid\fP"
.br
.RI "reference temperature "
.ti -1c
.RI "type(esmf_field), public \fBustar_target_grid\fP"
.br
.RI "friction velocity "
.ti -1c
.RI "integer, parameter \fBveg_type_landice_target\fP = 15"
.br
.RI "Vegetation type category that defines permanent land ice points\&. "
.ti -1c
.RI "type(esmf_field), public \fBw_0_target_grid\fP"
.br
.RI "Coefficient 3 to calculate d(tz)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBw_d_target_grid\fP"
.br
.RI "Coefficient 4 to calculate d(tz)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBxs_target_grid\fP"
.br
.RI "Salinity content in diurnal thermocline layer\&. "
.ti -1c
.RI "type(esmf_field), public \fBxt_target_grid\fP"
.br
.RI "Heat content in diurnal thermocline layer\&. "
.ti -1c
.RI "type(esmf_field), public \fBxtts_target_grid\fP"
.br
.RI "d(xt)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBxu_target_grid\fP"
.br
.RI "u-current content in diurnal thermocline layer "
.ti -1c
.RI "type(esmf_field), public \fBxv_target_grid\fP"
.br
.RI "v-current content in diurnal thermocline layer "
.ti -1c
.RI "type(esmf_field), public \fBxz_target_grid\fP"
.br
.RI "Diurnal thermocline layer thickness\&. "
.ti -1c
.RI "type(esmf_field), public \fBxzts_target_grid\fP"
.br
.RI "d(xz)/d(ts) "
.ti -1c
.RI "type(esmf_field), public \fBz0_target_grid\fP"
.br
.RI "roughness length "
.ti -1c
.RI "type(esmf_field), public \fBz_c_target_grid\fP"
.br
.RI "Sub-layer cooling thickness\&. "
.ti -1c
.RI "type(esmf_field), public \fBzm_target_grid\fP"
.br
.RI "Oceanic mixed layer depth\&. "
.in -1c
.SH "Detailed Description"
.PP 
Process surface and nst fields\&. 

Interpolates fields from the input to target grids\&. Adjusts soil temperature according to differences in input and target grid terrain\&. Rescales soil moisture for soil type differences between input and target grid\&. Computes frozen portion of total soil moisture\&.
.PP
Assumes the input land data are Noah LSM-based, and the fv3 run will use the Noah LSM\&. NSST fields are not available when using GRIB2 input data\&.
.PP
Public variables are defined below\&. 'target' indicates field associated with the target grid\&. 'input' indicates field associated with the input grid\&.
.PP
\fBAuthor\fP
.RS 4
George Gayno NCEP/EMC 
.RE
.PP

.SH "Function/Subroutine Documentation"
.PP 
.SS "subroutine surface::adjust_soil_levels (integer, intent(in) localpet)"

.PP
Adjust soil levels of the input grid if there is a mismatch between input and target grids\&. Presently can only convert from 9 to 4 levels\&.
.PP
\fBParameters\fP
.RS 4
\fIlocalpet\fP ESMF local persistent execution thread 
.RE
.PP
\fBAuthor\fP
.RS 4
Larissa Reames 
.PP
Jeff Beck 
.RE
.PP

.PP
Definition at line 3564 of file surface\&.F90\&.
.PP
References error_handler(), model_grid::i_input, model_grid::input_grid, model_grid::j_input, input_data::lsoil_input, model_grid::lsoil_target, input_data::soil_temp_input_grid, input_data::soilm_liq_input_grid, and input_data::soilm_tot_input_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::adjust_soilt_for_terrain"

.PP
Adjust soil temperature for changes in terrain height between the input and target grids\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 3488 of file surface\&.F90\&.
.PP
References error_handler(), model_grid::landmask_target_grid, soil_temp_target_grid, terrain_from_input_grid, model_grid::terrain_target_grid, veg_type_landice_target, and static_data::veg_type_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::calc_liq_soil_moisture"

.PP
Compute liquid portion of the total soil moisture\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 2522 of file surface\&.F90\&.
.PP
References program_setup::bb_target, blim, error_handler(), frh2o(), frz_h2o, grav, hlice, model_grid::landmask_target_grid, program_setup::maxsmc_target, program_setup::satpsi_target, soil_temp_target_grid, static_data::soil_type_target_grid, soilm_liq_target_grid, soilm_tot_target_grid, veg_type_landice_target, and static_data::veg_type_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::check_smois_land"

.PP
Check soil mositure\&. When using vegetation type from the input data instead of the orography file, there are frequently points with ~0 soil moisture at land points\&. For these points, set values in all relevant target grid surface arrays to fill values (done in check_smois_land) then run the search routine again to fill with appropriate values from nearby points (done in replace_land_sfcparams)\&.
.PP
\fBAuthor\fP
.RS 4
Larissa Reames 
.PP
Jeff Beck 
.RE
.PP

.PP
Definition at line 2795 of file surface\&.F90\&.
.PP
References static_data::alnsf_target_grid, static_data::alnwf_target_grid, static_data::alvsf_target_grid, static_data::alvwf_target_grid, canopy_mc_target_grid, error_handler(), static_data::facsf_target_grid, static_data::facwf_target_grid, model_grid::landmask_target_grid, static_data::max_veg_greenness_target_grid, static_data::min_veg_greenness_target_grid, static_data::mxsno_albedo_target_grid, static_data::slope_type_target_grid, soil_temp_target_grid, static_data::soil_type_target_grid, soilm_tot_target_grid, static_data::veg_greenness_target_grid, veg_type_landice_target, and static_data::veg_type_target_grid\&.
.SS "subroutine surface::cleanup_target_nst_data\fC [private]\fP"

.PP
Free up memory once the target grid nst fields are no longer needed\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 4824 of file surface\&.F90\&.
.PP
References c_0_target_grid, c_d_target_grid, d_conv_target_grid, dt_cool_target_grid, ifd_target_grid, qrain_target_grid, tref_target_grid, w_0_target_grid, w_d_target_grid, xs_target_grid, xt_target_grid, xtts_target_grid, xu_target_grid, xv_target_grid, xz_target_grid, xzts_target_grid, z_c_target_grid, and zm_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::cleanup_target_sfc_data\fC [private]\fP"

.PP
Free up memory once the target grid surface fields are no longer needed\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 4788 of file surface\&.F90\&.
.PP
References canopy_mc_target_grid, f10m_target_grid, ffmm_target_grid, q2m_target_grid, seaice_depth_target_grid, seaice_fract_target_grid, seaice_skin_temp_target_grid, skin_temp_target_grid, snow_depth_target_grid, snow_liq_equiv_target_grid, soil_temp_target_grid, soil_type_from_input_grid, soilm_liq_target_grid, soilm_tot_target_grid, srflag_target_grid, t2m_target_grid, terrain_from_input_grid, terrain_from_input_grid_land, tprcp_target_grid, ustar_target_grid, and z0_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::create_nst_esmf_fields"

.PP
Create ESMF fields for the target grid nst variables\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno 
.RE
.PP

.PP
Definition at line 4615 of file surface\&.F90\&.
.PP
References c_0_target_grid, c_d_target_grid, d_conv_target_grid, dt_cool_target_grid, error_handler(), ifd_target_grid, qrain_target_grid, model_grid::target_grid, tref_target_grid, w_0_target_grid, w_d_target_grid, xs_target_grid, xt_target_grid, xtts_target_grid, xu_target_grid, xv_target_grid, xz_target_grid, xzts_target_grid, z_c_target_grid, and zm_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::create_surface_esmf_fields"

.PP
Create ESMF fields for the target grid surface variables\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 4278 of file surface\&.F90\&.
.PP
References canopy_mc_target_grid, error_handler(), f10m_target_grid, ffmm_target_grid, lai_target_grid, model_grid::lsoil_target, q2m_target_grid, seaice_depth_target_grid, seaice_fract_target_grid, seaice_skin_temp_target_grid, skin_temp_target_grid, snow_depth_target_grid, snow_liq_equiv_target_grid, soil_temp_target_grid, soil_type_from_input_grid, soilm_liq_target_grid, soilm_tot_target_grid, srflag_target_grid, t2m_target_grid, model_grid::target_grid, terrain_from_input_grid, tprcp_target_grid, ustar_target_grid, and z0_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "real function surface::frh2o (real(esmf_kind_r8) TKELV, real(esmf_kind_r8) SMC, real(esmf_kind_r8) SH2O, real SMCMAX, real BEXP, real PSIS)"

.PP
Calculate supercooled soil moisture\&. Calculate amount of supercooled liquid soil water content if temperature is below 273\&.15K\&. Requires Newton-type iteration to solve the nonlinear implicit equation given in eqn 17 of Koren et\&. al (1999, JGR, VOL 104(D16), 19569-19585)\&.
.PP
New version (June 2001): Much faster and more accurate Newton iteration achieved by first taking log of eqn cited above -- less than 4 (typically 1 or 2) iterations achieves convergence\&. Also, explicit 1-step solution option for special case of parameter ck=0, which reduces the original implicit equation to a simpler explicit form, known as the 'Flerchinger eqn'\&. Improved handling of solution in the limit of freezing point temperature\&.
.PP
\fBParameters\fP
.RS 4
\fItkelv\fP Temperature (Kelvin) 
.br
\fIsmc\fP Total soil moisture content (volumetric) 
.br
\fIsh2O\fP Liquid soil moisture content (volumetric) 
.br
\fIsmcmax\fP Saturation soil moisture content 
.br
\fIbexp\fP Soil type 'b' parameter 
.br
\fIpsis\fP Saturated soil matric potential 
.RE
.PP
\fBReturns\fP
.RS 4
frh2O Supercooled liquid water content
.RE
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP
\fBDate\fP
.RS 4
2005-05-20 
.RE
.PP

.PP
Definition at line 3182 of file surface\&.F90\&.
.PP
References blim, frz_h2o, grav, and hlice\&.
.PP
Referenced by calc_liq_soil_moisture()\&.
.SS "subroutine surface::ij_to_i_j (integer(esmf_kind_i4), intent(in) ij, integer, intent(in) itile, integer, intent(in) jtile, integer, intent(out) i, integer, intent(out) j)"

.PP
Convert 1d index to 2d indices\&. 
.PP
\fBParameters\fP
.RS 4
\fIij\fP the 1d index 
.br
\fIitile\fP i-dimension of the tile 
.br
\fIjtile\fP j-dimension of the tile 
.br
\fIi\fP the 'i' index 
.br
\fIj\fP the 'j' index 
.RE
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 4759 of file surface\&.F90\&.
.PP
Referenced by interp()\&.
.SS "subroutine surface::interp (integer, intent(in) localpet)"

.PP
Horizontally interpolate surface fields from input to target FV3 grid using esmf routines\&. 
.PP
\fBParameters\fP
.RS 4
\fIlocalpet\fP ESMF local persistent execution thread
.RE
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 309 of file surface\&.F90\&.
.PP
References input_data::c_0_input_grid, c_0_target_grid, input_data::c_d_input_grid, c_d_target_grid, input_data::canopy_mc_input_grid, canopy_mc_target_grid, program_setup::convert_nst, input_data::d_conv_input_grid, d_conv_target_grid, input_data::dt_cool_input_grid, dt_cool_target_grid, error_handler(), program_setup::external_model, input_data::f10m_input_grid, f10m_target_grid, input_data::ffmm_input_grid, ffmm_target_grid, model_grid::i_target, input_data::ifd_input_grid, ifd_target_grid, ij_to_i_j(), model_grid::input_grid, program_setup::input_type, model_grid::j_target, program_setup::lai_from_climo, input_data::lai_input_grid, lai_target_grid, model_grid::landmask_target_grid, input_data::landsea_mask_input_grid, model_grid::latitude_target_grid, model_grid::lsoil_target, input_data::max_veg_greenness_input_grid, static_data::max_veg_greenness_target_grid, input_data::min_veg_greenness_input_grid, static_data::min_veg_greenness_target_grid, program_setup::minmax_vgfrc_from_climo, model_grid::num_tiles_target_grid, input_data::q2m_input_grid, q2m_target_grid, input_data::qrain_input_grid, qrain_target_grid, input_data::seaice_depth_input_grid, seaice_depth_target_grid, input_data::seaice_fract_input_grid, seaice_fract_target_grid, input_data::seaice_skin_temp_input_grid, seaice_skin_temp_target_grid, model_grid::seamask_target_grid, search_util::search(), input_data::skin_temp_input_grid, skin_temp_target_grid, input_data::snow_depth_input_grid, snow_depth_target_grid, input_data::snow_liq_equiv_input_grid, snow_liq_equiv_target_grid, input_data::soil_temp_input_grid, soil_temp_target_grid, soil_type_from_input_grid, input_data::soil_type_input_grid, static_data::soil_type_target_grid, input_data::soilm_tot_input_grid, soilm_tot_target_grid, program_setup::sotyp_from_climo, input_data::srflag_input_grid, srflag_target_grid, static_data::substrate_temp_target_grid, input_data::t2m_input_grid, t2m_target_grid, model_grid::target_grid, terrain_from_input_grid, terrain_from_input_grid_land, input_data::terrain_input_grid, program_setup::tg3_from_soil, input_data::tprcp_input_grid, tprcp_target_grid, input_data::tref_input_grid, tref_target_grid, input_data::ustar_input_grid, ustar_target_grid, input_data::veg_greenness_input_grid, static_data::veg_greenness_target_grid, input_data::veg_type_input_grid, input_data::veg_type_landice_input, veg_type_landice_target, static_data::veg_type_target_grid, program_setup::vgfrc_from_climo, program_setup::vgtyp_from_climo, input_data::w_0_input_grid, w_0_target_grid, input_data::w_d_input_grid, w_d_target_grid, input_data::xs_input_grid, xs_target_grid, input_data::xt_input_grid, xt_target_grid, input_data::xtts_input_grid, xtts_target_grid, input_data::xu_input_grid, xu_target_grid, input_data::xv_input_grid, xv_target_grid, input_data::xz_input_grid, xz_target_grid, input_data::xzts_input_grid, xzts_target_grid, input_data::z0_input_grid, z0_target_grid, input_data::z_c_input_grid, z_c_target_grid, input_data::zm_input_grid, and zm_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::nst_land_fill"

.PP
nst is not active at land or sea ice points\&. Set nst fields to flag values at these points\&.
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 4069 of file surface\&.F90\&.
.PP
References c_0_target_grid, c_d_target_grid, d_conv_target_grid, dt_cool_target_grid, error_handler(), ifd_target_grid, model_grid::landmask_target_grid, qrain_target_grid, skin_temp_target_grid, tref_target_grid, w_0_target_grid, w_d_target_grid, xs_target_grid, xt_target_grid, xtts_target_grid, xu_target_grid, xv_target_grid, xz_target_grid, xzts_target_grid, z_c_target_grid, and zm_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::qc_check"

.PP
Perform some quality control checks before output\&. 
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 3734 of file surface\&.F90\&.
.PP
References static_data::alnsf_target_grid, static_data::alnwf_target_grid, static_data::alvsf_target_grid, static_data::alvwf_target_grid, canopy_mc_target_grid, error_handler(), static_data::facsf_target_grid, static_data::facwf_target_grid, frz_ice, model_grid::landmask_target_grid, static_data::max_veg_greenness_target_grid, static_data::min_veg_greenness_target_grid, static_data::mxsno_albedo_target_grid, seaice_depth_target_grid, seaice_fract_target_grid, seaice_skin_temp_target_grid, skin_temp_target_grid, static_data::slope_type_target_grid, snow_depth_target_grid, snow_liq_equiv_target_grid, soil_temp_target_grid, static_data::soil_type_target_grid, soilm_liq_target_grid, soilm_tot_target_grid, static_data::substrate_temp_target_grid, static_data::veg_greenness_target_grid, veg_type_landice_target, and static_data::veg_type_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::replace_land_sfcparams (integer, intent(in) localpet)"

.PP
Replace bad surface points\&. When using vegetation type from the input data instead of the orography file, there are frequently points with ~0 soil moisture at land points\&. For these points, set values in all relevant target grid surface arrays to fill values (done in check_smois_land) then run the search routine again to fill with appropriate values from nearby points (done in replace_land_sfcparams)\&.
.PP
\fBParameters\fP
.RS 4
\fIlocalpet\fP ESMF local persistent execution thread 
.RE
.PP
\fBAuthor\fP
.RS 4
Larissa Reames 
.PP
Jeff Beck 
.RE
.PP

.PP
Definition at line 2979 of file surface\&.F90\&.
.PP
References static_data::alnsf_target_grid, static_data::alnwf_target_grid, static_data::alvsf_target_grid, static_data::alvwf_target_grid, canopy_mc_target_grid, error_handler(), static_data::facsf_target_grid, static_data::facwf_target_grid, model_grid::i_target, model_grid::j_target, model_grid::landmask_target_grid, model_grid::lsoil_target, static_data::max_veg_greenness_target_grid, static_data::min_veg_greenness_target_grid, static_data::mxsno_albedo_target_grid, search_util::search(), static_data::slope_type_target_grid, soil_temp_target_grid, static_data::soil_type_target_grid, soilm_tot_target_grid, static_data::veg_greenness_target_grid, and static_data::veg_type_target_grid\&.
.SS "subroutine surface::rescale_soil_moisture"

.PP
Adjust soil moisture for changes in soil type between the input and target grids\&. Works for Noah land model only\&. Required to preserve latent/sensible heat fluxes\&.
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 3320 of file surface\&.F90\&.
.PP
References program_setup::drysmc_input, program_setup::drysmc_target, error_handler(), model_grid::landmask_target_grid, program_setup::maxsmc_input, program_setup::maxsmc_target, program_setup::refsmc_input, program_setup::refsmc_target, soil_type_from_input_grid, static_data::soil_type_target_grid, soilm_tot_target_grid, static_data::veg_greenness_target_grid, veg_type_landice_target, static_data::veg_type_target_grid, program_setup::wltsmc_input, and program_setup::wltsmc_target\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine surface::roughness"

.PP
Set roughness length at land and sea ice\&. At land, roughness is set from a lookup table based on the vegetation type\&. At sea ice, roughness is set to 1 cm\&.
.PP
\fBAuthor\fP
.RS 4
George Gayno NOAA/EMC 
.RE
.PP

.PP
Definition at line 3680 of file surface\&.F90\&.
.PP
References error_handler(), model_grid::landmask_target_grid, static_data::veg_type_target_grid, and z0_target_grid\&.
.PP
Referenced by surface_driver()\&.
.SS "subroutine, public surface::surface_driver (integer, intent(in) localpet)"

.PP
Driver routine to process surface/nst data\&. 
.PP
\fBParameters\fP
.RS 4
\fIlocalpet\fP ESMF local persistent execution thread
.RE
.PP
\fBAuthor\fP
.RS 4
George Gayno NCEP/EMC 
.RE
.PP

.PP
Definition at line 150 of file surface\&.F90\&.
.PP
References adjust_soil_levels(), adjust_soilt_for_terrain(), calc_liq_soil_moisture(), program_setup::calc_soil_params_driver(), input_data::cleanup_input_nst_data(), input_data::cleanup_input_sfc_data(), static_data::cleanup_static_fields(), cleanup_target_nst_data(), cleanup_target_sfc_data(), program_setup::convert_nst, create_nst_esmf_fields(), create_surface_esmf_fields(), static_data::get_static_fields(), interp(), nst_land_fill(), qc_check(), input_data::read_input_nst_data(), input_data::read_input_sfc_data(), rescale_soil_moisture(), roughness(), program_setup::sotyp_from_climo, program_setup::vgtyp_from_climo, and write_fv3_sfc_data_netcdf()\&.
.PP
Referenced by chgres()\&.
.SH "Variable Documentation"
.PP 
.SS "real, parameter, private surface::blim = 5\&.5\fC [private]\fP"

.PP
soil 'b' parameter limit 
.PP
Definition at line 130 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), and frh2o()\&.
.SS "type(esmf_field), public surface::c_0_target_grid"

.PP
Coefficient 1 to calculate d(tz)/d(ts) 
.PP
Definition at line 80 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::c_d_target_grid"

.PP
Coefficient 2 to calculate d(tz)/d(ts) 
.PP
Definition at line 78 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::canopy_mc_target_grid"

.PP
canopy moisture content 
.PP
Definition at line 36 of file surface\&.F90\&.
.PP
Referenced by check_smois_land(), cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), replace_land_sfcparams(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::d_conv_target_grid"

.PP
Thickness of free convection layer\&. 
.PP
Definition at line 82 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::dt_cool_target_grid"

.PP
Sub-layer cooling amount\&. 
.PP
Definition at line 84 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::f10m_target_grid"

.PP
log((z0+10)*1/z0) See sfc_diff\&.f for details 
.PP
Definition at line 38 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::ffmm_target_grid"

.PP
log((z0+z1)*1/z0) See sfc_diff\&.f for details 
.PP
Definition at line 41 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "real, parameter, private surface::frz_h2o = 273\&.15\fC [private]\fP"

.PP
melting pt water 
.PP
Definition at line 132 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), and frh2o()\&.
.SS "real, parameter, private surface::frz_ice = 271\&.21\fC [private]\fP"

.PP
melting pt sea ice 
.PP
Definition at line 134 of file surface\&.F90\&.
.PP
Referenced by qc_check()\&.
.SS "real, parameter, private surface::grav = 9\&.81\fC [private]\fP"

.PP
gravity 
.PP
Definition at line 136 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), and frh2o()\&.
.SS "real, parameter, private surface::hlice = 3\&.335E5\fC [private]\fP"

.PP
latent heat of fusion 
.PP
Definition at line 138 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), and frh2o()\&.
.SS "type(esmf_field), public surface::ifd_target_grid"

.PP
Model mode index\&. 0-diurnal model not started; 1-diurnal model started\&. 
.PP
Definition at line 86 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::lai_target_grid"

.PP
leaf area index 
.PP
Definition at line 74 of file surface\&.F90\&.
.PP
Referenced by create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::q2m_target_grid"

.PP
2-m specific humidity 
.PP
Definition at line 44 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::qrain_target_grid"

.PP
Sensible heat flux due to rainfall\&. 
.PP
Definition at line 89 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::seaice_depth_target_grid"

.PP
sea ice depth 
.PP
Definition at line 46 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::seaice_fract_target_grid"

.PP
sea ice fraction 
.PP
Definition at line 48 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::seaice_skin_temp_target_grid"

.PP
sea ice skin temperature 
.PP
Definition at line 50 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::skin_temp_target_grid"

.PP
skin temperature/sst 
.PP
Definition at line 52 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), nst_land_fill(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::snow_depth_target_grid"

.PP
physical snow depth 
.PP
Definition at line 58 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::snow_liq_equiv_target_grid"

.PP
liquid equiv snow depth 
.PP
Definition at line 56 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::soil_temp_target_grid"

.PP
3-d soil temperature 
.PP
Definition at line 60 of file surface\&.F90\&.
.PP
Referenced by adjust_soilt_for_terrain(), calc_liq_soil_moisture(), check_smois_land(), cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), replace_land_sfcparams(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field) surface::soil_type_from_input_grid\fC [private]\fP"

.PP
soil type interpolated from input grid 
.PP
Definition at line 120 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and rescale_soil_moisture()\&.
.SS "type(esmf_field), public surface::soilm_liq_target_grid"

.PP
3-d liquid soil moisture 
.PP
Definition at line 62 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), cleanup_target_sfc_data(), create_surface_esmf_fields(), qc_check(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::soilm_tot_target_grid"

.PP
3-d total soil moisture 
.PP
Definition at line 64 of file surface\&.F90\&.
.PP
Referenced by calc_liq_soil_moisture(), check_smois_land(), cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), qc_check(), replace_land_sfcparams(), rescale_soil_moisture(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::srflag_target_grid"

.PP
snow/rain flag 
.PP
Definition at line 54 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::t2m_target_grid"

.PP
2-m temperatrure 
.PP
Definition at line 66 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field) surface::terrain_from_input_grid\fC [private]\fP"

.PP
terrain height interpolated from input grid 
.PP
Definition at line 123 of file surface\&.F90\&.
.PP
Referenced by adjust_soilt_for_terrain(), cleanup_target_sfc_data(), create_surface_esmf_fields(), and interp()\&.
.SS "type(esmf_field) surface::terrain_from_input_grid_land\fC [private]\fP"

.PP
terrain height interpolated from input grid at all land points 
.PP
Definition at line 126 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), and interp()\&.
.SS "type(esmf_field), public surface::tprcp_target_grid"

.PP
precip 
.PP
Definition at line 68 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::tref_target_grid"

.PP
reference temperature 
.PP
Definition at line 91 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::ustar_target_grid"

.PP
friction velocity 
.PP
Definition at line 70 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), and write_fv3_sfc_data_netcdf()\&.
.SS "integer, parameter surface::veg_type_landice_target = 15\fC [private]\fP"

.PP
Vegetation type category that defines permanent land ice points\&. The Noah LSM land ice physics are applied at these points\&. 
.PP
Definition at line 29 of file surface\&.F90\&.
.PP
Referenced by adjust_soilt_for_terrain(), calc_liq_soil_moisture(), check_smois_land(), interp(), qc_check(), and rescale_soil_moisture()\&.
.SS "type(esmf_field), public surface::w_0_target_grid"

.PP
Coefficient 3 to calculate d(tz)/d(ts) 
.PP
Definition at line 95 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::w_d_target_grid"

.PP
Coefficient 4 to calculate d(tz)/d(ts) 
.PP
Definition at line 93 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xs_target_grid"

.PP
Salinity content in diurnal thermocline layer\&. 
.PP
Definition at line 97 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xt_target_grid"

.PP
Heat content in diurnal thermocline layer\&. 
.PP
Definition at line 100 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xtts_target_grid"

.PP
d(xt)/d(ts) 
.PP
Definition at line 111 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xu_target_grid"

.PP
u-current content in diurnal thermocline layer 
.PP
Definition at line 103 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xv_target_grid"

.PP
v-current content in diurnal thermocline layer 
.PP
Definition at line 106 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xz_target_grid"

.PP
Diurnal thermocline layer thickness\&. 
.PP
Definition at line 109 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::xzts_target_grid"

.PP
d(xz)/d(ts) 
.PP
Definition at line 113 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::z0_target_grid"

.PP
roughness length 
.PP
Definition at line 72 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_sfc_data(), create_surface_esmf_fields(), interp(), roughness(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::z_c_target_grid"

.PP
Sub-layer cooling thickness\&. 
.PP
Definition at line 115 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SS "type(esmf_field), public surface::zm_target_grid"

.PP
Oceanic mixed layer depth\&. 
.PP
Definition at line 117 of file surface\&.F90\&.
.PP
Referenced by cleanup_target_nst_data(), create_nst_esmf_fields(), interp(), nst_land_fill(), and write_fv3_sfc_data_netcdf()\&.
.SH "Author"
.PP 
Generated automatically by Doxygen for chgres_cube from the source code\&.
